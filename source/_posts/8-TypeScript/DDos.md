前言


那么DDos攻击为何在各种黑客技术的起起伏伏。 攻伐思路的来来去去之间能如此恒久远都有流传下去，至今仍为网络安全的一个心头大患呢，

我们不妨来赏析一下DDOS的技术细节。



目录
本文主要讲述
 1. 互联网通信过程
 2. DDos攻击手段
 3. DDos治理和缓解方法


1. 引入Dos案例
 1996年9月6号美国纽约著名互联网服务商Panix的服务器受到每秒高达150次的异常连接攻击，导致服务器疲于应对这些非法流量而拒绝了正常用户的合法请求，
 这是目前大家比较认可的历史上第一次DOS攻击，

 DOS，Denial of Service, 拒绝服务。 系通过占用网络服务的资源让他应接不暇, 从而拒绝正常的业务流量的一种网络攻击方式。


2. 从而引申出DDos
而我们所属的DDos, 则是Dos攻击的分布式版本, 俗称“群殴”

DDos 分布式拒绝服务
Distributed denial of servie


3. 开始介绍DDos
   单台设备的攻击能力有限，治理起来也比较容易，但是当几十几百台，甚至是成千上万个设备组成一个网络，同时对目标发起Dos攻击时，无异于一场灾难.
  故而，大家一般用DDOS(分布式拒绝服务攻击), 指代一般意义的拒绝服务攻击。 而发起攻击的网络，一般称之为僵尸网络(BotNet)。

  每个僵尸网络可以是一台个人电脑。 可以是一台服务器，甚至也可以是一部智能手机。 而为了得到这样一个 僵尸网络则是八仙过海各显神通获，因为穷获因为技术过硬的人士。
利用，木马，蠕虫后门等恶意程序感染大量设备。形成僵尸网络

而富人则比较轻松，通过某些渠道。直接花钱就可以购买的。理论上你花的钱越多得到的就是网络规模就越大攻击力度的就越强，

1999年8月17号明尼苏达大学的服务器。在至少200台的设备的攻击下，服务被迫终止了两天。
这这两百多台发起攻击的设备都是在不知情的情况下被感染。而成为了僵尸网络中的一员。在通过IP追踪，并让设备停止攻击后。问题还是未能完全解决。因为不断有新的攻击设备加入进来。ddos 和其他里应用程序漏洞攻击的阴谋不同。这种直接粗暴的方式。算是一种阳谋，大家都知道是怎么发生的，但又无可奈何。直到今天ddos问题都没有，也无法被完全解决。



为了了解地倒是攻击手段的巧妙。我们需要先了解一点互联网的工作方式。一次网络访问的过程简化来看是这样的。客户端，通过网络线路向远程服务器请求内容。服务器按照客户端的需求或查询，或计算出相应的数据。再通过网络线路，返送给客户端。这个数据在两端流转的行为和传统的邮递过程十分相像。传统的邮递靠的是邮政系统。而现代互联网中的数据流转。则依靠的是以TCP IP协议为核心的通信系统。

TCP IP的参考模型是一个四层结构。我们可以借助传统的邮递系统，对此做个类比。写信的时候，大家一般会遵从约定的格式。比如先写对方的称呼。加个：再写正文。结尾写上此致敬礼。最后写上，数名和日期。这类似于四层结构中的应用层，规定了一些数据内容的协议规则。比如我们网上冲浪时，常用的http协议就属于这一层。写完信之后我们可以做一个标记。比如粘上一个鸡毛，或者盖上一个红戳，对方根据这些标记决定如何回复。要不要加急要不要确认一下对方的身份等等。这个类似于四层结构中的传输层。规定了数据的传输方式。比如这一从中大家熟悉的TCP协议。为了保证通信的可靠性。需要先经历三次握手，再发起数据传输。实际上，对于一次可靠的通信过程。事先的沟通是很必要的。这在日常生活中很常见。我们已电视剧三国演义中。孙策第一次遇见太史慈这个场景举例。谁是孙策？你是何人，我是东莱太史慈，前来捉拿孙策。你就是太史慈。我正要会你。你是何人。我是孙策。为了保证打架前没有搞错对象。孙策和太史慈反复确认了，对方的身份之后才开始动手。

TCP协议用三次握手做到这一点。换句话说在正式写信，说正事之前。先发送三丰确定彼此的信，建立一种可靠的连接。第一次在TCP协议的信件上有几个关键的字段。发起TCP连接时，我方先把Syn设置为1,ack设置为零。再选择一个顺序号X。然后发送出去。第二次对方收到后回复一封信。把S Y嗯，设置为一A C K设置为一。确认号设置为X +1，同时也选择一个顺序号y，第三次了我方收到回信后。S Yn设置为0，A C K设置为一。确认好设置为Y +1, 顺序号设置为X +1再次发送出去。如此一个TCP连接就建立起来。接下来就可以发送用户的数据了。因为有三次握手的存在通信要更加可靠。类似即时通信这样的软件。多采用TCP协议，在客户端和服务器之间建立一个连接通信。而这一层还有一个著名的U D P协议也没有这么麻烦。不需要反复握手，建立连接。直接把数据投递出去。也不管对方说没收到。所以这是一种不可靠的协议。

而用来装信件（数据）的信封，类似于四层数据中的网络层。主要规定了通信双方地址的编码规则。这一层采用的是IP协议。所以大家经常会听到所谓的设备IP地址。而一封信的投递，最终依靠的是邮局。邮局把信件打包装车后。根据收件地址，把信件投递到目的地。这一层对应着四层结构中的子网层，是信息传递的物理载体。比如以太网，卫星网等。周四从结构从应用层到子网层，数据按照不同的协议不断地被打包。到达目的地后，则刚好是相反的拆包过程，而最终被目标接受。可以看出来，其中最为核心的，是互联网层中的IP协议。只要是按照IP协议，封装数据都可以被发送。不管是以太网卫星网的，还是其他物理实现的子网，正如你只要按照信封上的格式，写好收发地址。装入的信件就可以被投递到目的。
不管是走，陆运空运还是海运。IP协议让不同的子网络被互联了起来。从这个通信过程中，我们发现。从数据离开到，最终到达这一路。几乎每个地方都有被他攻击的机会。


比如霸占服务器的网络贷款资源。我们只需要向一台服务器发送大量的IP协议数据包。就可以慢慢地消耗掉对方的网络带宽。比如用大家耳熟能详的pin工具，就可以发起一次攻击。ping产生的是I C M P协议包。iC M P是IP协议中用来进行差错控制的一个补充。本质上还是一个IP包。这种攻击方式也称之为S M P洪水( I C M P  F L O O D。，。这种攻击手段类似于我们不断地给某个人投递信件。写了什么不重要？重要的是让信件多的邮递员在对方家门口排起长队。从而打断正常的信件收发。同样的思路，我们还可以发送传输层的udP协议包。发起一次U D P洪水攻击( U D P空格F L O O D (，当然，这里会有一个问题，那就是会暴露攻击设备的IP地址。而被对方禁封，所以攻击者一般都会通过伪造，IP地址隐藏自己。比如张三给李四写信。但是把发件地址写成了王五，这样，即使是一封组胺问候信。李四也只能迁怒于王五。或者干脆写一个不存在的地址，让李四无处泄愤，

但出于隐藏自己这个目的。人们发明了一种更有趣的方式。反射攻击。既然可以伪造IP那就不必拘泥于伪造发件人的身份。同样可以伪造收件人的身份。达到借刀杀人的效果。我们把信封上的发件地址改为攻击目标的IP地址。然后把收件地址设置为互联网上大量的第三方机器。从而把数据发送到这些第三方机器上。这些机器在接收到数据之后。回复数据就会涌入发件，地址指向的攻击目标。这些第三方机器也被称之为反射器。这有点像把别人的电话号码挂在一些网站上。然后机主被不明真相的推销员给呼死。很损，但很有效。反射攻击更难追踪来源，



但更厉害的是，人们在此基础之上又发明了把攻击流量放大已达到更强攻击效果的手段。放大攻击，比如DNS服务器是一种用来，把域名解析为IP地址的设备。
我们在浏览器中输入像www .哔哩哔哩.com这样的域名地址。实际上需要先查询DNS服务器。获得这个域名对应的IP地址。再用IP地址，访问B站的服务器。同时，DNS查询通常使用U D P这个不用验证来源的传输协议。
综合来看DNS服务器就是一个很好的放大器。因为一次DNS请求返回的数据往往大于请求数据。这里有一个带宽放大因子BA F的概念。在DNS查询中。一般60字节请求数据可以获得3000字节的返回数据。那么B A F等于3000÷60等于50。产生50倍的放大效果。这样如果我们让攻击者不断地去对DNS服务器发起查询请求。并把原地址伪造为攻击目标的IP。那么这样的反射攻击就会产生50倍的流量放大效果。可谓，四两拨20斤。



除了对目标的带宽资源进行霸占，已达到攻击效果以外。因为TCP协议中有连接的概念。所以还可以攻击服务器连接资源。服务器和客户端每次建立一个TCP连接，需要经历三次握手，然后把连接信息放入连接表中维护。而连接表的大小是有限的。我们可以让发起攻击的设备，直接发起大量的TCP连接。从而沾满服务器这个连接表。而无法响应后续的TCP连接。从而达到dos攻击的效果。这种直接的方式称之为T C P洪水，( T C P F L O O D。 但是因为有三次握手的存在，所以TCP洪水无法通过伪造IP隐藏自己。在建立连接时，如果我们在第一次握手中伪造了up,那么服务器像客户端，发送数据的第二次握手就无法到达。相当于你给别人写了一封伪造发件地址的。那么你是不可能收到回信。因此，连接无法建立。但是可以在建立连接到三次握手，本身上作文。比如只发送S YN不进行后续的回答。这样虚晃一枪的S Y N洪水。这样做的好处是如果不回答攻击目标的S Y N + A C K数据考虑到可能是网络环境问题。TCP协议中有重传机制。对方会多次尝试发送S Y N + A C K直到超时。但问题是这时候受害者会不断地向攻击找发送S Y N + A C K。比如从事10次，那这就相当于我们每攻击目标一次。对方就会回击了10次。所谓杀敌1000自损10,000也不过如此。所以S Y N洪水攻击，一般都会伪造IP。或是一个不存在的，IP让受害者拔剑四顾心茫然。或是某个真实的倒霉蛋的IP。从而把祸水东引。同样的思路在TCP协议中，也可以通过反射发起攻击。向各个反射器发送SY N。并把发件地址为造成攻击目标的IP。这样大量的S Y N + A C K数据就会从各个反射器上涌入攻击目标。当然，这种攻击方式，因为无法在目标上建立连接，所以还是属于在攻击网络带宽。而针对TCP协议还有一种巧妙的攻击手段。R S T洪水攻击。在TCP协议中，一般用四次挥手结束连接。但是，为了防止一场一方可以发送一个R S T数据强制切断连接。这样，我们让攻击设备不断地尝试，伪造各种IP地址。并发送R S T数据进行盲打。一旦IP和其他的一些配置和某个正常用户的匹配上。就能切断正常用户和服务器之间的连接。这种攻击方式更针对用户。比如在一场网络游戏对战中。在获悉对手的IP地址之后。就可以不断切断对方的游戏设备和服务器之间的连接。以干扰正常游戏。不论是利用，IP U D P还是TCP协议攻击。针对的都是网络和连接资源。还有一种直接针对服务内部资源的攻击方式。消耗目标的计算资源和io资源，正如我们开头所说一次网络访问的过程是这样的。客户端(手机或电脑)通过网络线路。向远程的服务器请求内容，服务器按照客户端的需求或查询或计算。出相应的数据。在通过网络线路发送给客户端。作为在第五层的用户。一般在网上冲浪时接触的都是应用层中，像http这样的协议。比如我们访问B站的时候在浏览器输入。H T T P / / Www .哔哩哔哩.com。所以我们可以对一个站点发起http洪水攻击。比如利用站点的搜索功能。不断生成大量的关键词送入查询地址。因为http请求作为用户直接发起的，涉及具体业务的请求。服务器在收到请求后需要进行一下数据库，查询这样的Io操作。所以这样的攻击手法会对目标产生更大的消耗。当然，http洪水攻击有个问题。那就是不能伪造IP地址。因为http协议实际上是基于TCP协议的。须要经历三次握手的过程。所以，常见的方法是借助网络代理主机得到不同的真实的IP地址发起攻击。这对于一次资金充足，有计划有组织地攻击来说并不是一件难事。




D D O S攻击还有一些其他的方式。这里就不在一一列举。但所谓有攻就有防哪里有压迫，哪里就有反抗？所以有哪些应对D D O S攻击的方法呢呢？目前有两种大的方向。第一种激进的手术治疗第二种稳妥的保守治疗。捣毁僵尸网络，并让用户做好防备，避免被感染成僵尸设备是一种很好的方法。但这是需要长期持续进行的方案。我们局两个典型的在技术层面上，根据D D O S攻击的方法。从D D O S的攻击原理上我们可以看出来，伪造IP地址是D D O S攻击的核心手段之一，一但攻击者，无法伪造IP地址。那几乎就形同冢中枯骨强弩之末。而治理伪造IP的方法并不复杂。现在互联网的下游，也就是用户设备接入的这一端。设备通过路由（或者通过多个路由网关）接入互联网服务提供商ISP，所以只要让路由设备检测IP。把源地址，IP不属于本路由所在网段的数据都过滤掉。这样试图伪造IP的流量就无法发出。还有一个稍微复杂一点的分布式过滤方案。我们知道庞大的互联网中不同的网段，依靠路由把彼此连接。一个数据从甲发送到乙，他的IP可以伪造成丙，但是他所经过真实线路则不可能作假。换句话说从丙到乙的数据不可能经过路由a，但是这个伪造IP的数据从甲发送到乙却经过了A，如果路由能根据IP地址的路径逻辑，检测出矛盾。那么就可以过滤掉这样的流量。从而消灭伪造IP的伎俩。当然一个涉及到用户，服务商，设备商。甚至是监管部门的等多方的技术方案。那就不能只是一个技术问题。出于商业上投入产出的考虑。往往是木已成舟积重难返。




这两种方案很难被执行。只有有一定影响力的大型企业和机构。才能撬动这种涉及全球的多方合作。对于中小企业甚至是刚起步的创业，企业来说并不现实。所以人们提出了一些，大家都能承担得起的缓解D D O S攻击的保守治疗方案。我们也列举两个目前使用比较多的方案。D D O S攻击的可怕之处在于第一个D-分布式。当一个僵尸网络对一个目标发起攻击，是很难处理这些来自四面八方的流量。但所谓师夷长技以制夷，敌人可以群起而攻之，那作为守法公民，我们又何尝不能联合起来。把一个网络服务的流量，分散到不同的。从而稀释攻击流量。比如目前各个站点普遍采用的CDn技术。把一些相对静态的资源，作为缓存分发给各个C D嗯节点。用户在请求的时候，从最近的节点返回。这样就在一定程度上缓解了D D O S的攻击。当然，C D N的缓解作用比较有限。有一种目前比较主流的，有一些厂商专门为此开发产品的方案。流量清洗，我们在服务器前架设一台流量清洗设备。这个设备就像一个身高马大的保镖和秘书。帮我们对抗D D O S流量。比如面对TCP协议的S Y N洪水D D O S攻击。客户端发起的S Y N先经过清洗设备。有清洗设备回复，S Y N + A C K。如果对方应答了，那说明是正常流量。清洗设备再把本次连接交给后方到服务器正常通信。如果对方不应答，清洗设备该重试重试。超时后就断开连接。但因为清洗设备人高马大。作为专门应对攻击的角色。对连接资源做了极大的专门的优化。能应对极其海量的连接请求。所以，攻击者想要通过S YN洪水打垮，他非常困难，再比如威胁极大的，http洪水攻击。正常来说一个http请求。很难用传统的方式，检测出是恶意流量还是正常流量。而清洗设备往往会提供专业的流量清洗平台，这些专业做流量清洗的平台通过多年和D D O S攻击的对抗，积累了大量的经验和技术，比如，由于http协议无法伪造IP地址。所以通过多年的数据积累，建立IP信用库，从那些经常发起攻击的臭名昭著的IP发来的流量就会被过滤掉。这有点像现在的安卓手机上的来电标记。这是流量清洗厂商在数据积累上的优势。再比如恶意流量，由于是通过程序自动发出。而不是人类的操作。所以利用算法对流量进行模式，识别就可以被检测出来。这是流量清洗厂商在技术上的优势。但不论怎样D D O S作为一种历史悠久。但破坏能力巨大的黑客攻击手段。
时至今日还是无法被彻底解决，或许你可以说弟弟O S攻击源自互联网通信架构。在设计之初，考虑的缺失。而人们现在又缺乏壮士断腕的决心，从根本上消灭。但不论怎样这种破坏与对抗将长久的存在于互联网世界之中，而我们能做的就是做好防护保持警惕。






